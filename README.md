# count_pairs

## Описание

`count_pairs` — консольное приложение для поиска в текстовом файле уникальных пар заданных слов, расположенных на расстоянии не более указанного максимума слов.

Приложение принимает в качестве аргументов путь к текстовому файлу, два слова для поиска и максимальное расстояние между ними (в количестве слов, которые их разделяют). Программа выводит количество уникальных пар таких слов, найденных в файле.

Обратите внимание: порядок слов в паре важен, то есть пары `(слово1, слово2)` и `(слово2, слово1)` считаются разными и обычно дают разные результаты.

## Синтаксис

```
count_pairs.exe <путь_к_файлу> <слово1> <слово2> <максимальное_расстояние>
```

## Параметры

- `<путь_к_файлу>` — путь к текстовому файлу для анализа (должен быть в кодировке Windows-1251).
- `<слово1>` — первое слово в паре.
- `<слово2>` — второе слово в паре.
- `<максимальное_расстояние>` — максимальное число слов, которые могут разделять заданные слова.

## Описание работы

- Программа открывает текстовый файл в кодировке Windows-1251, обеспечивая корректную работу с русскими и латинскими символами.
- Текст разбивается на отдельные слова, знаки пунктуации и переводы строк игнорируются.
- Каждому слову в тексте присваивается порядковый индекс, начиная с 0.
- Расстояние между словами считается как количество слов, которые находятся между ними. Например, если слова `налоги` и `России` разделяют 5 слов, то расстояние равно 5.
- Программа ищет и подсчитывает количество уникальных пар вхождений слов `<слово1>` и `<слово2>`, расположенных в пределах указанного максимального расстояния с учётом порядка слов (слово1 должно встретиться раньше слова2).
- Каждое слово из текста может участвовать максимум в одной паре.
- Пары формируются динамически в зависимости от заданного расстояния.  
  Например, для строки:
```
... налоги(1) налоги(2) России(3) России(4) ...
```

- При вызове `count_pairs.exe налоги России 1` будут сформированы пары `(1, 3)` и `(2, 4)`.
- При вызове `count_pairs.exe налоги России 0` — одна пара `(2, 3)` (слова идут подряд).


## Коды возврата

- `1` — недостаточно аргументов при запуске.
- `2` — ошибка открытия файла.
- `3` — параметр `<максимальное_расстояние>` задан неверно (должно быть целым положительным числом).

## Технические детали реализации

- Программа устанавливает кодировку консоли Windows в CP1251 для корректного отображения русского текста.
- Используется посимвольный парсинг файла, где слова приводятся к нижнему регистру, учитывая особенности кириллицы в CP1251.
- При проходе по тексту фиксируются порядковые позиции слов `<слово1>` и `<слово2>` в два отсортированных массива.
- Для подсчёта уникальных пар применяется алгоритм с двумя указателями, находящий максимально возможное количество пар, удовлетворяющих ограничению по расстоянию и порядку слов.
- Каждое слово может быть использовано в паре не более одного раза, что обеспечивает корректность подсчёта.

## Алгоритм решения

1. **Чтение и кодировка:**  
   Файл открывается в кодировке Windows-1251 (однобайтовой), что облегчает нормализацию и обработку русского и латинского алфавитов.

2. **Индексация слов:**  
   Программа один раз последовательно проходит по файлу, выделяя слова — последовательности букв без учёта знаков препинания и переносов строк. Каждому слову присваивается порядковый индекс. Позиции встреченных заданных слов заносятся в соответствующие списки.

3. **Формирование пар (динамическое программирование):**  
   На основе двух отсортированных списков позиций `word1` и `word2` производится поиск максимального количества пар уникальных вхождений, таких что:  
   - Позиция слова из `word2` больше позиции слова из `word1` (соблюдается порядок слов).  
   - Расстояние между ними `(pos_word2[j] - pos_word1[i] - 1)` не больше заданного максимума.  
   Каждое слово может участвовать только в одной паре. Алгоритм реализован с использованием двух указателей, двигающихся по спискам параллельно, что обеспечивает линейную по суммарному количеству вхождений сложность.

4. **Сложность:**  
   - Чтение файла и индексация слов — `O(N)`, где N — количество слов в тексте.  
   - Поиск пар — `O(n + m)`, где n и m — количество вхождений `word1` и `word2` соответственно.  
   Такой подход является оптимальным для данной задачи.

## Трудности при реализации и их решения

### Проблемы с кодировкой

- Во время разработки возникли сложности с обработкой русского текста в многобайтовых кодировках (например, UTF-8), что усложняло разбивку на слова и нормализацию регистра.
- Решением стало использование однобайтовой кодировки Windows-1251, позволяющей обрабатывать символы посимвольно, включая корректную работу с русскими символами и упрощённое приведение к нижнему регистру.

### Алгоритмическая оптимальность

- Полный просмотр всех слов файла — обязательный шаг, так как поиск пропущенных вхождений невозможен без полного анализа текста. Это даёт сложность `O(N)`.
- Формирование пар реализовано через два указателя по отсортированным спискам с линейной сложностью `O(n+m)`, что является оптимальным с учётом поставленных условий.

---

## Документация, сгенерированная с помощью генеративного ИИ

Для создания данной документации использовалась модель GPT-4 от OpenAI, выбранная благодаря глубокому пониманию технических задач и способности формировать чёткие, структурированные описания. В качестве основы и промпта были использованы:  

- текст задания;  
- исходный код программы;  
- пример документации к команде `ipconfig.md` для стилистического ориентира.

## Ход решения

1. Анализ ТЗ, добавление конкретики в двусмысленных местах
2. Разработка оптимального алгоритма
3. Использование ИИ для написания программы чтения файла и построчного вывода всех слов
4. Решение вопросв с кодировкой
5. "Индексирование" заданных слов
6. Использование ИИ для реализации жадного алгоритма
7. Тестирование

### Behave тестирование
```
Feature: Поиск пар слов в файле # features/search.feature:1

  Scenario: Поиск в Налоговом кодексе - расстояние 5                    # features/search.feature:4
    Given используем тестовый файл "Налоговый_кодекс.txt"               # features/steps/steps.py:5
    When ищем пару слов "налоги" "России" на расстоянии не более 5 слов # features/steps/steps.py:9
    Then находим 1 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Поиск в Налоговом кодексе - расстояние 4                    # features/search.feature:9
    Given используем тестовый файл "Налоговый_кодекс.txt"               # features/steps/steps.py:5
    When ищем пару слов "налоги" "России" на расстоянии не более 4 слов # features/steps/steps.py:9
    Then находим 0 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Поиск в Налоговом кодексе - налоги и доходы                 # features/search.feature:14
    Given используем тестовый файл "Налоговый_кодекс.txt"               # features/steps/steps.py:5
    When ищем пару слов "налоги" "доходы" на расстоянии не более 1 слов # features/steps/steps.py:9
    Then находим 2 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Поиск в Налоговом кодексе - большое расстояние                # features/search.feature:19
    Given используем тестовый файл "Налоговый_кодекс.txt"                 # features/steps/steps.py:5
    When ищем пару слов "налоги" "доходы" на расстоянии не более 100 слов # features/steps/steps.py:9
    Then находим 2 совпадение(ий)                                         # features/steps/steps.py:69

  Scenario: Повторяющиеся слова - расстояние 0                          # features/search.feature:25
    Given используем тестовый файл "repeating.txt"                      # features/steps/steps.py:5
    When ищем пару слов "налоги" "России" на расстоянии не более 0 слов # features/steps/steps.py:9
    Then находим 1 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Обратный порядок слов - доходы Россия                       # features/search.feature:31
    Given используем тестовый файл "reversed.txt"                       # features/steps/steps.py:5
    When ищем пару слов "Доходы" "России" на расстоянии не более 2 слов # features/steps/steps.py:9
    Then находим 2 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Обратный порядок слов - Россия доходы                       # features/search.feature:36
    Given используем тестовый файл "reversed.txt"                       # features/steps/steps.py:5
    When ищем пару слов "России" "доходы" на расстоянии не более 2 слов # features/steps/steps.py:9
    Then находим 1 совпадение(ий)                                       # features/steps/steps.py:69

  Scenario: Английский текст                                         # features/search.feature:42
    Given используем тестовый файл "english.txt"                     # features/steps/steps.py:5
    When ищем пару слов "Tax" "Russia" на расстоянии не более 3 слов # features/steps/steps.py:9
    Then находим 1 совпадение(ий)                                    # features/steps/steps.py:69

  Scenario: Пустой файл                                                 # features/search.feature:48
    Given используем тестовый файл "empty.txt"                          # features/steps/steps.py:5
    When ищем пару слов "налоги" "России" на расстоянии не более 5 слов # features/steps/steps.py:9
    Then получаем сообщение об ошибке "максимальное_расстояние должно быть целым положительным числом" с кодом 3 # features/steps/steps.py:74

  Scenario: Ошибка - отрицательное расстояние                                                                    # features/search.feature:59
    Given используем тестовый файл "Налоговый_кодекс.txt"                                                        # features/steps/steps.py:5
    When пытаемся искать с отрицательным расстоянием                                                             # features/steps/steps.py:33
    Then получаем сообщение об ошибке "максимальное_расстояние должно быть целым положительным числом" с кодом 3 # features/steps/steps.py:74

  Scenario: Ошибка - несуществующий файл                                  # features/search.feature:64
    When пытаемся искать в несуществующем файле                           # features/steps/steps.py:45
    Then получаем сообщение об ошибке "не удалось открыть файл" с кодом 2 # features/steps/steps.py:74

  Scenario: Ошибка - недостаточно аргументов                    # features/search.feature:68
    When запускаем программу без аргументов                     # features/steps/steps.py:57
    Then получаем сообщение об ошибке "Использование" с кодом 1 # features/steps/steps.py:74

1 feature passed, 0 failed, 0 skipped
13 scenarios passed, 0 failed, 0 skipped
37 steps passed, 0 failed, 0 skipped, 0 undefined
Took 0m0.673s
```


